<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Pessoas</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 0;
            background-color: #f4f4f9;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background: #ffffff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
        }
        form {
            margin-bottom: 20px;
        }
        input, button {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        button {
            background-color: #007BFF;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        .output {
            padding: 10px;
            background: #e9ecef;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Cadastro de Pessoas</h1>
        <form id="cadastroForm">
            <input type="text" id="numeroCompra" placeholder="Número da Compra">
            <input type="text" id="nome" placeholder="Nome" required>
            <input type="text" id="cpf" placeholder="CPF" required>
            <input type="text" id="telefone" placeholder="Telefone" required>
            <button type="submit">Cadastrar/Atualizar</button>
        </form>

        <form id="consultaForm">
            <input type="text" id="cpfConsulta" placeholder="Digite o CPF para consultar" required>
            <button type="submit">Consultar</button>
        </form>

        <div class="output" id="output"></div>

        <!-- Lista de Pessoas -->
        <ul id="lista"></ul>
    </div>

    <script>
    const cadastroForm = document.getElementById('cadastroForm');
    const consultaForm = document.getElementById('consultaForm');
    const output = document.getElementById('output');
    const listaPessoas = document.getElementById('lista');

    // Função para atualizar a lista de pessoas
    async function atualizarLista() {
        listaPessoas.innerHTML = '<li>Carregando...</li>';
        try {
            const response = await fetch('http://145.223.94.114:3100/pessoas');
            if (!response.ok) throw new Error('Erro ao carregar lista.');
            const pessoas = await response.json();

            listaPessoas.innerHTML = '';
            if (pessoas.length === 0) {
                listaPessoas.innerHTML = '<li>Nenhum cadastro encontrado.</li>';
                return;
            }

            pessoas.forEach(pessoa => {
                const item = document.createElement('li');
                item.textContent = `Nome: ${pessoa.nome}, CPF: ${pessoa.cpf}, Telefone: ${pessoa.telefone}, Compras: ${pessoa.numeroCompra}`;
                listaPessoas.appendChild(item);
            });
        } catch (error) {
            console.error(error);
            listaPessoas.innerHTML = '<li>Erro ao carregar lista de pessoas.</li>';
        }
    }

    cadastroForm.addEventListener('submit', async (e) => {
        e.preventDefault();

        const numeroCompra = document.getElementById('numeroCompra').value;
        const nome = document.getElementById('nome').value;
        const cpf = document.getElementById('cpf').value;
        const telefone = document.getElementById('telefone').value;

        try {
            const response = await fetch('http://145.223.94.114:3100/pessoas', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ numeroCompra, nome, cpf, telefone }),
            });

            const result = await response.json();
            output.textContent = result.message;
            cadastroForm.reset();
            atualizarLista();
        } catch (error) {
            console.error(error);
            output.textContent = 'Erro ao processar o cadastro.';
        }
    });

    consultaForm.addEventListener('submit', async (e) => {
        e.preventDefault();

        const cpfConsulta = document.getElementById('cpfConsulta').value;
        try {
            const response = await fetch(`http://145.223.94.114:3100/pessoas/${cpfConsulta}`);
            if (!response.ok) throw new Error('CPF não encontrado.');

            const pessoa = await response.json();
            document.getElementById('nome').value = pessoa.nome;
            document.getElementById('cpf').value = pessoa.cpf;
            document.getElementById('telefone').value = pessoa.telefone;
            output.textContent = 'CPF encontrado! Adicione um novo número de compra ou atualize as informações.';
        } catch (error) {
            console.error(error);
            output.textContent = 'CPF não encontrado. Complete o cadastro.';
        }

        consultaForm.reset();
    });

    // Atualiza a lista ao carregar a página
    atualizarLista();
</script>

</body>
</html>
